<!doctype html><html lang=da-dk><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=theme-color content="#495f5c"><meta name=msapplication-TileColor content="#495f5c"><meta itemprop=name content="Hierarchical Edge Bundles in R"><meta itemprop=description content="Hierarchical edge bundling of a gene network. Blue indicate negative correlations, red indicate positive. The darker the color, the more strong the correlation.
  Background During the finalization of my PhD, I implemented the so-called Hierarchical Edge Bundling plotting method for a paper now published in the Annals of Applied Statistics. Though the plot above sadly did not make the final cut, I admit due to an lack of added value, it appeared in the original submission and the thesis."><meta itemprop=datePublished content="2020-01-03T00:00:00&#43;00:00"><meta itemprop=dateModified content="2020-01-03T20:45:29&#43;01:00"><meta itemprop=wordCount content="1427"><meta itemprop=image content="https://bilgrau.com/network2.jpg"><meta itemprop=keywords content="hierachical clustering,graphs,visualisation,"><meta property="og:title" content="Hierarchical Edge Bundles in R"><meta property="og:description" content="Hierarchical edge bundling of a gene network. Blue indicate negative correlations, red indicate positive. The darker the color, the more strong the correlation.
  Background During the finalization of my PhD, I implemented the so-called Hierarchical Edge Bundling plotting method for a paper now published in the Annals of Applied Statistics. Though the plot above sadly did not make the final cut, I admit due to an lack of added value, it appeared in the original submission and the thesis."><meta property="og:type" content="article"><meta property="og:url" content="https://bilgrau.com/posts/hierachical-edge-bundles/"><meta property="og:image" content="https://bilgrau.com/network2.jpg"><meta property="article:published_time" content="2020-01-03T00:00:00+00:00"><meta property="article:modified_time" content="2020-01-03T20:45:29+01:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bilgrau.com/network2.jpg"><meta name=twitter:title content="Hierarchical Edge Bundles in R"><meta name=twitter:description content="Hierarchical edge bundling of a gene network. Blue indicate negative correlations, red indicate positive. The darker the color, the more strong the correlation.
  Background During the finalization of my PhD, I implemented the so-called Hierarchical Edge Bundling plotting method for a paper now published in the Annals of Applied Statistics. Though the plot above sadly did not make the final cut, I admit due to an lack of added value, it appeared in the original submission and the thesis."><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><title>Hierarchical Edge Bundles in R</title><link rel=stylesheet href=https://bilgrau.com/css/style.min.657bcb7af31123e4156b1a3d2ff60a636717e54ead74f882136b5114cf72b55e.css integrity="sha256-ZXvLevMRI+QVaxo9L/YKY2cX5U6tdPiCE2tRFM9ytV4=" crossorigin=anonymous><style>.bg-img{background-image:url(https://bilgrau.com/network2.jpg)}</style><link rel=stylesheet href=https://bilgrau.com/css/table2.css></head><body id=page><header id=site-header class="animated slideInUp faster"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://bilgrau.com>Anders Ellern Bilgrau</a></div><nav class="site-nav hide-in-mobile"><a href=https://bilgrau.com/about/>Om mig</a>
<a href=https://bilgrau.com/portfolio/>Portefølje</a>
<a href=https://bilgrau.com/posts/>Blog</a></nav></div><div class="hdr-right hdr-icons"><button id=img-btn class=hdr-btn><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-image"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg></button><button id=toc-btn class="hdr-btn desktop-only-ib"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3" y2="6"/><line x1="3" y1="12" x2="3" y2="12"/><line x1="3" y1="18" x2="3" y2="18"/></svg></button><span class="hdr-social hide-in-mobile"><a href=mailto:anders.ellern.bilgrau@gmail.com target=_blank rel="noopener me" title=Email><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a><a href=https://linkedin.com/in/aebilgrau target=_blank rel="noopener me" title=Linkedin><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a href=https://github.com/AEBilgrau target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0 0 20 4.77 5.07 5.07.0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38.0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 0 0 5 4.77a5.44 5.44.0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 0 0 9 18.13V22"/></svg></a><a href=https://stackoverflow.com/u/1568306 target=_blank rel="noopener me" title=Stackoverflow><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.913 16.041v6.848h17.599v-6.848M7.16 18.696h8.925M7.65 13.937l8.675 1.8M9.214 9.124l8.058 3.758M12.086 4.65l6.849 5.66M15.774 1.111l5.313 7.162"/></svg></a><a href=https://twitter.com/aebilgrau target=_blank rel="noopener me" title=Twitter><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 0 1-3.14 1.53 4.48 4.48.0 0 0-7.86 3v1A10.66 10.66.0 0 1 3 4s-4 9 5 13a11.64 11.64.0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5.0 0 0-.08-.83A7.72 7.72.0 0 0 23 3z"/></svg></a><a href="https://scholar.google.dk/citations?user=zQNl61YAAAAJ" target=_blank rel="noopener me" title="Google scholar"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="m12.16356 1.21951c-6.08385.0-11.02547 4.94161-11.02547 11.02547.0 6.08385 4.94162 11.02547 11.02547 11.02547 4.75437.0 7.6568-2.18712 9.16791-4.89852 1.51112-2.71145 1.70214-5.89661 1.24338-8.07438l-.08988-.37448h-.37453l-9.94689-.01501h-.47937v4.98845h5.48277c-.82768 1.91747-2.51294 3.23574-5.00341 3.23574-3.25448.0-5.88722-2.63278-5.88722-5.88726s2.63273-5.88722 5.88722-5.88722c1.46246.0 2.79006.54116 3.81999 1.4231l.34452.28465 3.28071-3.2807.34452-.35952-.35952-.32956c-1.95865-1.78453-4.57274-2.87621-7.43021-2.87621v-1e-5zm0 .95873c2.4324.0 4.627.88945 6.36663 2.32194l-2.30696 2.30698c-1.14041-.85203-2.52608-1.40814-4.05967-1.40814-3.77315.0-6.84595 3.0728-6.84595 6.84595s3.07279 6.84599 6.84595 6.84599c3.14025.0 5.3985-1.925 6.20182-4.53905l.19477-.61417h-5.91723v-3.07098l9.03311.01501c.3183 1.93429.10671 4.71128-1.18347 7.02571-1.3707 2.45676-3.86117 4.4042-8.32902 4.4042-5.56705.0-10.06673-4.50156-10.06673-10.06673.0-5.56517 4.49968-10.06673 10.06673-10.06673l1e-5 1e-5z"/></svg></a></span><button id=menu-btn class=hdr-btn><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://bilgrau.com/about/>Om mig</a></li><li><a href=https://bilgrau.com/portfolio/>Portefølje</a></li><li><a href=https://bilgrau.com/posts/>Blog</a></li></ul></div><div class=bg-img></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>January 3, 2020</span></div><h1>Hierarchical Edge Bundles in R</h1></header><div class=content><figure class=big><img src=/images/network2.jpg alt=image><figcaption><p>Hierarchical edge bundling of a gene network. Blue indicate negative correlations, red indicate positive. The darker the color, the more strong the correlation.</p></figcaption></figure><h2 id=background>Background<a href=#background class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>During the finalization of my PhD, I implemented the so-called <em>Hierarchical Edge Bundling</em> plotting method for a paper now <a href=https://projecteuclid.org/euclid.aoas/1536652979>published in the Annals of Applied Statistics</a>.
Though the plot above sadly did not make the final cut, I admit due to an lack of added value, it appeared in the original submission and the thesis.
Suffice it to say, I was still quite pleased with the method at the time, so I wrapped the methods into an <strong>R</strong>-package called <a href=https://github.com/AEBilgrau/HierarchicalEdgeBundles><strong>HierachicalEdgeBundles</strong></a>.
The plan was then to do a very small paper on this topic but I never got around to it. This a poor attempt of rectifying that.</p><p>The plot above illustrates estimated correlations of selected genes within the disease called diffuse large B-cell lymphoma the method.</p><h2 id=what-is-hierarchical-edge-bundling>What is hierarchical edge bundling?<a href=#what-is-hierarchical-edge-bundling class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>Hierarchical edge bundling is a visualization technique for displaying the relations in a network that additionally submit to some hierarchical structure.
The method was originally suggested in 2006 in a <a href=https://ieeexplore.ieee.org/document/4015425>lovely paper by Danny Holten</a>.
In short, hierarchical edge bundling visualizes graphs (of nodes and edges) by guiding the edges along along a hierarchical tree of the nodes.
A bundling parameter then controls how tightly the edges follow this underlying tree.
So what data fits into this technique?</p><h3 id=the-data>The data<a href=#the-data class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>The typical data suitable for this visualization needs two basic properties:</p><ol><li>The data can be represented as a graph (directed or undirected)</li><li>The data can be arranged hierarchically</li></ol><p>If the data does not adhere to one of these properties the lacking properties may often be constructed.
Now, I say &lsquo;data&rsquo; here. But by &lsquo;data&rsquo; I mean the likely processed data that goes in to the plotting method, not necessarily the <em>collected</em> data.</p><p>Let me illustrate by using the <strong>R</strong> package.</p><h2 id=using-the-hierarchicaledgebundles-package>Using the <strong>HierarchicalEdgeBundles</strong> package<a href=#using-the-hierarchicaledgebundles-package class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><h3 id=installation>Installation<a href=#installation class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>First things first. To install the package directly from the <a href=https://github.com/AEBilgrau/HierarchicalEdgeBundles>repository on GitHub</a>, we run:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=c1>#install.packages(&#34;remotes&#34;)  # Uncomment if devtools is not installed</span>
<span class=n>remotes</span><span class=o>::</span><span class=nf>install_github</span><span class=p>(</span><span class=s>&#34;AEBilgrau/HierarchicalEdgeBundles&#34;</span><span class=p>)</span></code></pre></div><p>Then we load the needed packages:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>library</span><span class=p>(</span><span class=s>&#34;HierarchicalEdgeBundles&#34;</span><span class=p>)</span>
<span class=nf>library</span><span class=p>(</span><span class=s>&#34;ape&#34;</span><span class=p>)</span>
<span class=nf>library</span><span class=p>(</span><span class=s>&#34;igraph&#34;</span><span class=p>)</span></code></pre></div><h3 id=toy-data>Toy data<a href=#toy-data class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>To illustrate the package use, we use a typical go-to dataset in <strong>R</strong>.
The <code>mtcars</code> dataset:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>data</span><span class=p>(</span><span class=n>mtcars</span><span class=p>)</span>
<span class=nf>head</span><span class=p>(</span><span class=n>mtcars</span><span class=p>,</span> <span class=n>n</span> <span class=o>=</span> <span class=m>10</span><span class=p>)</span></code></pre></div><table><thead><tr><th align=left></th><th align=center>mpg</th><th align=center>cyl</th><th align=center>disp</th><th align=center>hp</th><th align=center>drat</th><th align=center>wt</th><th align=center>qsec</th><th align=center>vs</th><th align=center>am</th><th align=center>gear</th><th align=center>carb</th></tr></thead><tbody><tr><td align=left>Mazda RX4</td><td align=center>21.0</td><td align=center>6</td><td align=center>160.0</td><td align=center>110</td><td align=center>3.90</td><td align=center>2.620</td><td align=center>16.46</td><td align=center>0</td><td align=center>1</td><td align=center>4</td><td align=center>4</td></tr><tr><td align=left>Mazda RX4 Wag</td><td align=center>21.0</td><td align=center>6</td><td align=center>160.0</td><td align=center>110</td><td align=center>3.90</td><td align=center>2.875</td><td align=center>17.02</td><td align=center>0</td><td align=center>1</td><td align=center>4</td><td align=center>4</td></tr><tr><td align=left>Datsun 710</td><td align=center>22.8</td><td align=center>4</td><td align=center>108.0</td><td align=center>93</td><td align=center>3.85</td><td align=center>2.320</td><td align=center>18.61</td><td align=center>1</td><td align=center>1</td><td align=center>4</td><td align=center>1</td></tr><tr><td align=left>Hornet 4 Drive</td><td align=center>21.4</td><td align=center>6</td><td align=center>258.0</td><td align=center>110</td><td align=center>3.08</td><td align=center>3.215</td><td align=center>19.44</td><td align=center>1</td><td align=center>0</td><td align=center>3</td><td align=center>1</td></tr><tr><td align=left>Hornet Sportabout</td><td align=center>18.7</td><td align=center>8</td><td align=center>360.0</td><td align=center>175</td><td align=center>3.15</td><td align=center>3.440</td><td align=center>17.02</td><td align=center>0</td><td align=center>0</td><td align=center>3</td><td align=center>2</td></tr><tr><td align=left>Valiant</td><td align=center>18.1</td><td align=center>6</td><td align=center>225.0</td><td align=center>105</td><td align=center>2.76</td><td align=center>3.460</td><td align=center>20.22</td><td align=center>1</td><td align=center>0</td><td align=center>3</td><td align=center>1</td></tr><tr><td align=left>Duster 360</td><td align=center>14.3</td><td align=center>8</td><td align=center>360.0</td><td align=center>245</td><td align=center>3.21</td><td align=center>3.570</td><td align=center>15.84</td><td align=center>0</td><td align=center>0</td><td align=center>3</td><td align=center>4</td></tr><tr><td align=left>Merc 240D</td><td align=center>24.4</td><td align=center>4</td><td align=center>146.7</td><td align=center>62</td><td align=center>3.69</td><td align=center>3.190</td><td align=center>20.00</td><td align=center>1</td><td align=center>0</td><td align=center>4</td><td align=center>2</td></tr><tr><td align=left>Merc 230</td><td align=center>22.8</td><td align=center>4</td><td align=center>140.8</td><td align=center>95</td><td align=center>3.92</td><td align=center>3.150</td><td align=center>22.90</td><td align=center>1</td><td align=center>0</td><td align=center>4</td><td align=center>2</td></tr><tr><td align=left>Merc 280</td><td align=center>19.2</td><td align=center>6</td><td align=center>167.6</td><td align=center>123</td><td align=center>3.92</td><td align=center>3.440</td><td align=center>18.30</td><td align=center>1</td><td align=center>0</td><td align=center>4</td><td align=center>4</td></tr></tbody></table><p>The <code>mtcars</code> contains data for various specs of 32 cars where only the <code>n = 10</code> first cars are shown above. Run <code>help(&quot;mtcars&quot;)</code> to read more about this dataset.</p><h3 id=analysis-of-features>Analysis of features<a href=#analysis-of-features class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>Suppose that we would like to examine features of these cars and how they relate to each other.
So it is natural to evaluate all pairs of features by some metric.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=c1># Compute correlation matrix of features</span>
<span class=n>car_cor</span> <span class=o>&lt;-</span> <span class=nf>cor</span><span class=p>(</span><span class=n>mtcars</span><span class=p>)</span>
<span class=nf>print</span><span class=p>(</span><span class=nf>round</span><span class=p>(</span><span class=n>car_cor</span><span class=p>,</span> <span class=m>1</span><span class=p>))</span></code></pre></div><pre><code>##       mpg  cyl disp   hp drat   wt qsec   vs   am gear carb
## mpg   1.0 -0.9 -0.8 -0.8  0.7 -0.9  0.4  0.7  0.6  0.5 -0.6
## cyl  -0.9  1.0  0.9  0.8 -0.7  0.8 -0.6 -0.8 -0.5 -0.5  0.5
## disp -0.8  0.9  1.0  0.8 -0.7  0.9 -0.4 -0.7 -0.6 -0.6  0.4
## hp   -0.8  0.8  0.8  1.0 -0.4  0.7 -0.7 -0.7 -0.2 -0.1  0.7
## drat  0.7 -0.7 -0.7 -0.4  1.0 -0.7  0.1  0.4  0.7  0.7 -0.1
## wt   -0.9  0.8  0.9  0.7 -0.7  1.0 -0.2 -0.6 -0.7 -0.6  0.4
## qsec  0.4 -0.6 -0.4 -0.7  0.1 -0.2  1.0  0.7 -0.2 -0.2 -0.7
## vs    0.7 -0.8 -0.7 -0.7  0.4 -0.6  0.7  1.0  0.2  0.2 -0.6
## am    0.6 -0.5 -0.6 -0.2  0.7 -0.7 -0.2  0.2  1.0  0.8  0.1
## gear  0.5 -0.5 -0.6 -0.1  0.7 -0.6 -0.2  0.2  0.8  1.0  0.3
## carb -0.6  0.5  0.4  0.7 -0.1  0.4 -0.7 -0.6  0.1  0.3  1.0
</code></pre><p>Since <code>car_cor</code> is a symmetric matrix it can be represented by a complete edge-weighted graph were the weights are the correlations. Using the <code>igraph</code> package, we can display it as such easily:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=c1># Create igraph</span>
<span class=n>car_graph</span> <span class=o>&lt;-</span> <span class=nf>graph_from_adjacency_matrix</span><span class=p>(</span>
  <span class=n>car_cor</span><span class=p>,</span> <span class=n>mode</span> <span class=o>=</span> <span class=s>&#34;undirected&#34;</span><span class=p>,</span> <span class=n>weighted</span> <span class=o>=</span> <span class=kc>TRUE</span><span class=p>,</span> <span class=n>diag</span> <span class=o>=</span> <span class=kc>FALSE</span>
<span class=p>)</span>

<span class=c1># Function for mapping correlations to colors</span>
<span class=n>make_colors</span> <span class=o>&lt;-</span> <span class=nf>function</span><span class=p>(</span><span class=n>wgt</span><span class=p>)</span> <span class=p>{</span>  
  <span class=n>cr</span> <span class=o>&lt;-</span> <span class=nf>colorRamp</span><span class=p>(</span><span class=nf>c</span><span class=p>(</span><span class=s>&#34;tomato&#34;</span><span class=p>,</span> <span class=s>&#34;white&#34;</span><span class=p>,</span> <span class=s>&#34;seagreen&#34;</span><span class=p>),</span> <span class=n>space</span> <span class=o>=</span> <span class=s>&#34;Lab&#34;</span><span class=p>)</span>
  <span class=n>v</span> <span class=o>&lt;-</span> <span class=nf>cr</span><span class=p>((</span><span class=n>wgt</span> <span class=o>+</span> <span class=m>1</span><span class=p>)</span><span class=o>/</span><span class=m>2</span><span class=p>)</span> <span class=c1># map linearly to [0, 1]</span>
  <span class=nf>return</span><span class=p>(</span><span class=nf>rgb</span><span class=p>(</span><span class=n>v[</span><span class=p>,</span><span class=m>1</span><span class=n>]</span><span class=p>,</span> <span class=n>v[</span><span class=p>,</span><span class=m>2</span><span class=n>]</span><span class=p>,</span> <span class=n>v[</span><span class=p>,</span> <span class=m>3</span><span class=n>]</span><span class=p>,</span> <span class=n>maxColorValue</span> <span class=o>=</span> <span class=m>255</span><span class=p>))</span>
<span class=p>}</span>

<span class=c1># Tweaks for some pretty plotting </span>
<span class=nf>E</span><span class=p>(</span><span class=n>car_graph</span><span class=p>)</span><span class=o>$</span><span class=n>width</span> <span class=o>&lt;-</span> <span class=m>4</span><span class=o>*</span><span class=nf>abs</span><span class=p>(</span><span class=nf>E</span><span class=p>(</span><span class=n>car_graph</span><span class=p>)</span><span class=o>$</span><span class=n>weight</span><span class=p>)</span>
<span class=nf>E</span><span class=p>(</span><span class=n>car_graph</span><span class=p>)</span><span class=o>$</span><span class=n>color</span> <span class=o>&lt;-</span> <span class=nf>make_colors</span><span class=p>(</span><span class=nf>E</span><span class=p>(</span><span class=n>car_graph</span><span class=p>)</span><span class=o>$</span><span class=n>weight</span><span class=p>)</span>
<span class=nf>V</span><span class=p>(</span><span class=n>car_graph</span><span class=p>)</span><span class=o>$</span><span class=n>label.color</span> <span class=o>&lt;-</span> <span class=s>&#34;black&#34;</span>
<span class=nf>V</span><span class=p>(</span><span class=n>car_graph</span><span class=p>)</span><span class=o>$</span><span class=n>size</span> <span class=o>&lt;-</span> <span class=m>8</span>
<span class=nf>V</span><span class=p>(</span><span class=n>car_graph</span><span class=p>)</span><span class=o>$</span><span class=n>color</span> <span class=o>&lt;-</span> <span class=s>&#34;white&#34;</span>

<span class=nf>par</span><span class=p>(</span><span class=n>mar</span> <span class=o>=</span> <span class=nf>c</span><span class=p>(</span><span class=m>0</span><span class=p>,</span> <span class=m>0</span><span class=p>,</span> <span class=m>0</span><span class=p>,</span> <span class=m>0</span><span class=p>))</span>
<span class=nf>plot</span><span class=p>(</span><span class=n>car_graph</span><span class=p>,</span> <span class=n>layout</span> <span class=o>=</span> <span class=nf>layout_in_circle</span><span class=p>(</span><span class=n>car_graph</span><span class=p>))</span></code></pre></div><p><img src=/images/hierachical-edge-bundles.en/car_dist_plot-1.png alt="plot of chunk car_dist_plot"></p><p>This gives us the first of our two new ingredients &mdash; a graph of the features.</p><p>Using <code>as.dist</code> and and the sample correlation matrix we we can compute a dissimilarity matrix:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=c1># Compute pairwise &#39;distances&#39; (high absolute correlation features are &#39;close&#39;)</span>
<span class=n>car_dist</span> <span class=o>&lt;-</span> <span class=nf>as.dist</span><span class=p>(</span><span class=m>1</span> <span class=o>-</span> <span class=nf>abs</span><span class=p>(</span><span class=n>car_cor</span><span class=p>))</span>
<span class=nf>print</span><span class=p>(</span><span class=nf>round</span><span class=p>(</span><span class=n>car_dist</span><span class=p>,</span> <span class=m>1</span><span class=p>))</span></code></pre></div><pre><code>##      mpg cyl disp  hp drat  wt qsec  vs  am gear
## cyl  0.1                                        
## disp 0.2 0.1                                    
## hp   0.2 0.2  0.2                               
## drat 0.3 0.3  0.3 0.6                           
## wt   0.1 0.2  0.1 0.3  0.3                      
## qsec 0.6 0.4  0.6 0.3  0.9 0.8                  
## vs   0.3 0.2  0.3 0.3  0.6 0.4  0.3             
## am   0.4 0.5  0.4 0.8  0.3 0.3  0.8 0.8         
## gear 0.5 0.5  0.4 0.9  0.3 0.4  0.8 0.8 0.2     
## carb 0.4 0.5  0.6 0.3  0.9 0.6  0.3 0.4 0.9  0.7
</code></pre><p>These distances are measures of &lsquo;dissimilarity&rsquo; or &lsquo;unrelatedness&rsquo; between the car features.
Greater values corresponds to a greater dissimilarity of the features and vice versa.
We do not bother here to consider if the &lsquo;1 minus the absolute Pearson correlation&rsquo; measure is a particularly well-suited measure for this (it is perhaps not). Nonetheless, the intuition here is that strong correlations (negative or positive) are considered &lsquo;close&rsquo; and near-zero correlations are considered distant. I.e. this gives a crude measure of dependence.</p><p>Using the dissimilarities we can, for example, use regular hierarchical clustering to arrive at the second ingredient needed:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=n>car_phylo</span> <span class=o>&lt;-</span> <span class=nf>as.phylo</span><span class=p>(</span><span class=nf>hclust</span><span class=p>(</span><span class=n>car_dist</span><span class=p>,</span> <span class=s>&#34;ave&#34;</span><span class=p>))</span>
<span class=nf>plot</span><span class=p>(</span><span class=n>car_phylo</span><span class=p>)</span></code></pre></div><p><img src=/images/hierachical-edge-bundles.en/hclust_plot-1.png alt="plot of chunk hclust_plot"></p><p>A tree of the features.</p><p>We happily notice that features which a priori are connected indeed also are (strongly) correlated and cluster together; e.g. the number of *cyl*inders and *disp*lacement, the weight of the cars (<em>wt</em>) strongly reflects in other features, etc. This is also illustrated in the graph which we styled using our distance measure.</p><p>Notice that we&rsquo;ve wrapped the tree from <code>hclust</code> in <code>as.phylo</code> from the <strong>ape</strong> package to convert it for later use. The reason is that the plotting method uses the internal nodes of the tree and those are (or at least were) not available in the tree object from <code>hclust</code>.</p><p>We are now ready to bundle the edges of the graph above.</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>plotHEB</span><span class=p>(</span><span class=n>car_graph</span><span class=p>,</span> <span class=n>car_phylo</span><span class=p>,</span> <span class=n>beta</span> <span class=o>=</span> <span class=m>0.8</span><span class=p>,</span> <span class=n>type</span> <span class=o>=</span> <span class=s>&#34;fan&#34;</span><span class=p>,</span>
        <span class=n>e.cols</span> <span class=o>=</span> <span class=nf>E</span><span class=p>(</span><span class=n>car_graph</span><span class=p>)</span><span class=o>$</span><span class=n>color</span><span class=p>,</span> <span class=n>args.lines</span> <span class=o>=</span> <span class=nf>list</span><span class=p>(</span><span class=n>lwd</span> <span class=o>=</span> <span class=m>2</span><span class=p>))</span></code></pre></div><p><img src=/images/hierachical-edge-bundles.en/bundling-1.png alt="plot of chunk bundling"></p><p>Or with a little less bundling and as the phylogram and the internal nodes of the underlying tree plotted as well:</p><div class=highlight><pre class=chroma><code class=language-r data-lang=r><span class=nf>plotHEB</span><span class=p>(</span><span class=n>car_graph</span><span class=p>,</span> <span class=n>car_phylo</span><span class=p>,</span> <span class=n>beta</span> <span class=o>=</span> <span class=m>0.7</span><span class=p>,</span> <span class=n>type</span> <span class=o>=</span> <span class=s>&#34;cladogram&#34;</span><span class=p>,</span>
        <span class=n>e.cols</span> <span class=o>=</span> <span class=nf>E</span><span class=p>(</span><span class=n>car_graph</span><span class=p>)</span><span class=o>$</span><span class=n>color</span><span class=p>,</span> <span class=n>args.lines</span> <span class=o>=</span> <span class=nf>list</span><span class=p>(</span><span class=n>lwd</span> <span class=o>=</span> <span class=m>2</span><span class=p>))</span></code></pre></div><p><img src=/images/hierachical-edge-bundles.en/alt_bundle-1.png alt="plot of chunk alt_bundle"></p><p>As can be noted in the documentation of the package, it is <code>plot.phylo</code> from <strong><code>ape</code></strong> that controls much of the plotting. This also explains the excessive white space in this layout as the entire tree would normally be drawn (as seen above).</p><h2 id=final-remarks>Final remarks<a href=#final-remarks class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>The hiearachical edge bundling plotting method certainly produces pretty graphics
and useful in the right contexts. For them to be truely useful they need a careful construction of coloring, linewidth, and layout, and unfortunately the number of available layouts (in R) are lacking at the moment.</p><h2 id=references>References<a href=#references class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><ul><li><p>Danny Holten (2006) <a href=https://ieeexplore.ieee.org/document/4015425><strong>&ldquo;Hierarchical Edge Bundles: Visualization of Adjacency Relations in Hierarchical Data&rdquo;</strong></a>, IEEE Transactions on Visualization and Computer Graphics, 12 (5): 741&ndash;748. <a href=https://ieeexplore.ieee.org/document/4015425>https://ieeexplore.ieee.org/document/4015425</a></p></li><li><p>Bilgrau, Anders Ellern; Brøndum, Rasmus Froberg; Eriksen, Poul Svante; Dybkær, Karen; Bøgsted, Martin. <a href=https://projecteuclid.org/euclid.aoas/1536652979>Estimating a common covariance matrix for network meta-analysis of gene expression datasets in diffuse large B-cell lymphoma.</a> Ann. Appl. Stat. 12 (2018), no. 3, 1894&ndash;1913. doi:10.<sup>1214</sup>&frasl;<sub>18</sub>-AOAS1136. <a href=https://projecteuclid.org/euclid.aoas/1536652979>https://projecteuclid.org/euclid.aoas/1536652979</a></p></li></ul></div><hr class=post-end><footer class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-feather"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"/><line x1="16" y1="8" x2="2" y2="22"/><line x1="17.5" y1="15" x2="9" y2="15"/></svg>Anders Ellern Bilgrau</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83.0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://bilgrau.com/tags/hierachical-clustering>hierachical clustering</a></span><span class=tag><a href=https://bilgrau.com/tags/graphs>graphs</a></span><span class=tag><a href=https://bilgrau.com/tags/visualisation>visualisation</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2020-01-03 00:00 UTC</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"/><line x1="1.05" y1="12" x2="7" y2="12"/><line x1="17.01" y1="12" x2="22.96" y2="12"/></svg><a href=https://github.com/AEBilgrau/AEBilgrau.github.io/commit/2e86ec1b433b2ed57eea4f4216190090ef3a6151 target=_blank rel=noopener>2e86ec1</a> @ 2020-01-03</p></footer></article><aside id=toc><div class=toc-title></div><nav id=TableOfContents><ul><li><ul><li><a href=#background>Background</a></li><li><a href=#what-is-hierarchical-edge-bundling>What is hierarchical edge bundling?</a><ul><li><a href=#the-data>The data</a></li></ul></li><li><a href=#using-the-hierarchicaledgebundles-package>Using the <strong>HierarchicalEdgeBundles</strong> package</a><ul><li><a href=#installation>Installation</a></li><li><a href=#toy-data>Toy data</a></li><li><a href=#analysis-of-features>Analysis of features</a></li></ul></li><li><a href=#final-remarks>Final remarks</a></li><li><a href=#references>References</a></li></ul></li></ul></nav></aside><div class="post-nav thin"></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2020 <a href=https://bilgrau.com>Anders Ellern Bilgrau</a> · <a href=/>dansk</a> · <a href=/en/>english</a></p><p>Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> &#183; Theme <a href=https://github.com/Track3/hermit target=_blank rel=noopener>Hermit</a> &#183; <a href=https://bilgrau.com/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"/><path d="M4 4a16 16 0 0 1 16 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></footer><script src=https://bilgrau.com/js/bundle.min.4a9a0ac3d2217822c7865b4161e6c2a71de1d70492264337755427898dd718f6.js integrity="sha256-SpoKw9IheCLHhltBYebCpx3h1wSSJkM3dVQniY3XGPY=" crossorigin=anonymous></script></body></html>